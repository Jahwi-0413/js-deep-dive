# 14장 전역 변수의 문제점

전역 변수의 무분별한 사용은 위험함

## 14.1 변수의 생명 주기

### 14.1.1 지역 변수의 생명 주기

지역 변수는 함수가 호출되면 생성되고 함수가 종료하면 소멸함
변수 호이스팅은 전역 변수에 한정된 것임
지역 변수는 함수가 호출되면 가장 먼저 선언된다. 함수 내부에서 호이스팅이 일어난다고 보면 됨

변수의 생명주기는 메모리 공간이 확보된 시점부터 메모리 공간이 해제되어 가용 메모리 풀에 반환되는 시점까지이다.
함수 내부에서 선언된 변수는 스코프에 등록되고 렉시컬 스코프는 물리적인 실체가 있다.
따라서 변수는 자신이 등록된 스코프가 소멸될때까지 유효함.

할당된 메모리 공간은 아무도 참조하지 않을때 가비지 콜렉터에 의해 해제되고 가용 메모리 풀에 반환함

일반적으로 함수가 종룍하면 함수가 생성된 스코프도 소멸한다.
하지만 누군가가 스코프를 참조하고 있으면 스코프가 해제되지 않고 생존함 -> 클로저에서 계속됨

```javascript
var x = "global";

function foo() {
  console.log(x); //undefined
  var x = "local";
}

foo();
console.log(x); //global
```

호이스팅은 스코프 단위로 동작함
foo 내부의 x는 지역 변수 x를 참조하고 x는 호이스팅이 일어나 undefined로 초기화된다

### 14.1.2 전역 변수의 생명 주기

전역 변수는 전역 객체의 프로퍼티가 되고 전역 객체의 생명 주기와 일치하다는 뜻이다.

> 전역 객체
>
> 자바스크립트 엔진에 의해 코드 실행전에 생성되는 객체
> client-side에서는 window, server-side에서는 global 객체를 뜻함
> 전역 객체는 빌트인 객체와 환경에 따른 호스트 객체(client-side: web api, server-side: host api), var 키워드로 선언한 전역 변수와 전역 함수를 프로퍼티로 가짐

브라우저의 전역 객체는 window이고 window는 웹페이지를 닫기 전까지 유효함

## 14.2 전역 변수의 문제점

- 암묵적 결합
  전역 변수는 모든 코드가 전역 변수를 참조하고 변경할 수 있는 암묵적 결합을 허용하는것
  변수의 유효 범위가 크면 가독성이 나쁘고 의도치 않게 상태가 변경될 수 있는 위험성도 높아짐

- 긴 생명 주기
  메모리 리소스도 오랜 기간 소비함
  var 키워드는 중복 선언을 허용해 var 키워드로 선언한 변수는 의도치 않은 재할당이 이루어짐

- 스코프 체인 상에서 종점에 존재
  전역 변수는 스코프 체인 상 종점에 있어 **검색 속도가 가장 느림**

- 네임스페이스 오염
  파일이 분리되어 있어도 전역 스코프를 공유해 다른 파일에서 같은 식별자가 있을때 문제가 됨

## 14.3 전역 변수의 사용을 억제하는 방법

전역 변수를 반드시 사용해야할 이유가 없다면 지역 변수를 사용할것

### 14.3.1 즉시 실행 함수

모든 코드를 즉시 실행 함수로 감싸면 즉시 실행 함수의 지역 변수가 됨
라이브러리 등에서 자주 사용함

### 14.3.2 네임스페이스 객체

전역에 네임스페이스 역할을 담당할 객체를 생성해 프로퍼티로 추가하기
식별자 충돌을 방지하긴 하지만 네임스페이스 객체가 전역이라서 좋은 방법은 아님

### 14.3.3 모듈 패턴

관련있는 변수와 함수를 모아 즉시 실행 함수로 감싸 모듈을 만듬
모듈 패턴은 클로저 기반으로 작동함
모듈 패턴은 정보 은닉을 구현하기 위해 사용함

```javascript
var Counter = function () {
  var num = 0;

  return {
    increase() {
      return ++num;
    },
  };
};

console.log(Counter.num); //undefined
```

즉시 실행 함수는 객체를 반환함.
외부에 노출할 public member는 객체에 담아 반환하고
노출하지 않을 private member는 객체에 추가하지 않으면 된다.

### 14.3.4 ES6 모듈

ES6 모듈은 전역 변수를 사용할 수 없음.
ES6 모듈은 파일 자체의 독자적인 모듈 스코프를 제공함

`<script type="module" src="index.mjs"></script>` 사용시 자바스크립트 파일이 모듈로 동작. 확장자는 mjs 권장
